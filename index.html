<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Form with API Call</title>
    <link rel="icon" href="assets/VizorAds-logo.png"/> 
    <style>
        
        @font-face {
            font-family: 'Mont';
            src: url(fonts/Mont-HeavyDEMO.otf);
        }
*{
    /**border-style: solid;**/
    scroll-behavior: smooth;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
        body {
            font-family: 'Mont', sans-serif;
            background-color: #f4f4f4;
            background-image: url(assets/ScanBG.jpg);
            background-size: cover;
            background-repeat: no-repeat;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
            
        }

        form {
                /*background-color: #fff;*/
                /*background: rgba(255, 255, 255, 0.9);*/
                /* padding: 20px;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.6); */
               /* margin-top: 10vh;*/ /* Add margin-top to center the form */
               /* width: 60%;
               max-width: 400px;
               margin: 5vh auto;
               box-sizing: border-box; */
               margin: 2vh auto;
               padding: 20px;
               box-sizing: border-box; 
               /*padding-left: 200px;*/
               padding-left: 20px;
               padding-right: 20px;
               max-width: 600px;
            }

        label {
            display: block;
            margin-bottom: 8px;
        }

        input {
            width: 100%;
            height: 40px;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
           border: .1px none #ccc;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding-left: 10px;
            margin-right: 0px;
        }

        button {
            background-color: #13fcc1;
            color: #000;
            padding: 10px 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            margin-right: 150px;
            margin-left: 150px;
            width:130px;
        }

        button:hover {
            background-color: #7af9da;
        }

        

        /* Add media query for smaller screens */
        @media only screen and (max-width: 600px) {
            body {
                height: auto;
            }
        
            form {
                width: 90%; /* Adjust form width for smaller screens */
                margin: 5vh auto;

                padding-left: 10px;
                padding-right: 10px;
            }
        
            .popup {
                width: 90%; /* Adjust popup width for smaller screens */
            }

            .genLabel{
                padding-bottom: 20px;

                padding-right: 10px;
                margin-right: 0;

            }
        }

/* Other existing styles remain unchanged */


        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            z-index: 1;
            overflow-y: auto; /* Add scroll bars for vertical overflow */
            max-height: 80vh; /
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Styles for centering the download button */
        button#downloadButton {
            display: block;
            margin: 0 auto;
        }

        /* Styles for positioning the close button on the top right */
         button#closeButton {
            position: absolute;
            padding-bottom: 10px;
            /* margin-right: 10px; */
            top: -6px;
            /* top: 5px; */
            /* bottom: 10px; */
            right: -88px;
            width: 20px; /* Adjust width to one third of its size */
            height: 10px; /* Adjust height to one third of its size */
            font-size: 18px; /* Adjust font size if needed */
            background-color: transparent; /* Remove the green background */
            color: #000; /* Set the text color to black */
            border: none; /* Remove any border */
            cursor: pointer;
        }

        button#closeButton:hover{
            color: rgb(216, 94, 94)
        }

        .genLabel{
            display: flex;
            justify-content: flex-start;
            align-items: start;
            padding-right: 30px;
            padding-bottom: -5px;
            padding-top: -50px;
            margin-right: 20px;
            margin-bottom: 1px;
            font-style: none;
            margin-top: 0px;
        }    
        a{
            text-decoration: none;
            color: inherit;
        }
        
        .genLabel:hover{
            color: #fff;
        }

        .vLogo{
            
            width: 120px;
            height: 60px;
            padding: 5px;
            display: flex;
            justify-content: start;
            align-items:start;
            margin-right: 1000px;
            margin-top: -600px;
            padding-top: 0;
            position: fixed;
        }

        .cLogo{
            width: 70px;
            height: 60px;
           margin: 5px;
           margin-top:-30px;
             /* display: flex; */
            /* flex-direction: row-reverse; */
        }
        .submitSection{
            flex-direction: row-reverse;
        }

        .error{
            border: 2px solid red; 
        }

    </style>
</head>
<body>
   
    <img src="assets/VizorAds-logo.png" class="vLogo"/>

       <a href="#myForm"> <h1 class="genLabel">Generate Your QR :)</h1></a>
        
    

<form id="myForm" class="fisrtForm"  >
    <label for="firstname">Name:</label>
    <input type="text" placeholder="eg. John"  id="firstname" name="firstname" required>

    <label for="jobtitle">Job Title:</label>
    <input type="text" placeholder="eg. Sales Manager, Engineer, etc" id="jobtitle" name="jobtitle" required>

    <label for="company">Company:</label>
    <input type="text" placeholder="Company name"  id="company" name="company" required>

     <label for="phone">Phone Number:</label>
    <input type="tel" placeholder="eg. (072) 354 6789" id="phone" name="phone" required>

    <label for="email">Email:</label>
    <input type="email" placeholder="eg. johndoe@example.com" id="email" name="email" required>

   <label for="email">Website:</label>
    <input type="url" placeholder="eg. www.example.com" id="url" name="url" required>
    <p id="errormsg"></p>
    <!-- Updated submit button with id -->
    <div class="submitSection">
    <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>
    
</div>

</form>
<img class="cLogo" src="assets/Logo_FC-transparent_RGB.png"/>
<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
    <button id="closeButton" onclick="closePopup()">close</button>
    <div id="imageContainer"></div>
    <div id="popupContent">
        <!-- Container for the image -->
        
    </div>
    <p id="apiResponse"></p>
    
</div>

<div class="overlay" id="loaderOverlay"></div>
<div class="loader" id="loader"></div>

<script>
function submitForm() {
    

    //validate correct inputs
    
    //validation
    var firstname = document.getElementById('firstname').value;
    var jobtitle = document.getElementById('jobtitle').value;
    var company = document.getElementById('company').value;
    var phone = document.getElementById('phone').value;
    var email = document.getElementById('email').value;
    var url = document.getElementById('url').value;
    if(firstname === '' || company === '' || jobtitle === '' || phone === '' || email === '' || url === ''){
        // alert('Please fill in all fields');   
        highlightEmptyFields(firstname, 'firstname');
        highlightEmptyFields(jobtitle, 'jobtitle');
        highlightEmptyFields(company, 'company');
        highlightEmptyFields(phone, 'phone');
        highlightEmptyFields(email, 'email');
        highlightEmptyFields(url, 'url');
        document.getElementById('errormsg').innerText = "Please fill in all fields*";
    }else if(!isValidPhone(phone)){
        highlightField('phone');
    }else{

        
    // Disable submit button while waiting for API response
    document.getElementById('submitBtn').disabled = true;

    // Display loader while waiting for API response
    showLoader();

    // Convert form data to JSON
      const formData = {
        firstname,
        jobtitle,
        company,
        phone,
        email,
        url
      };

      // Send a POST request with JSON payload
      fetch('https://preprod.api.chenosis.io/vizorads/vcard/generate', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData) })
    .then(response => response.blob())
    .then(data => {
        // Hide loader when API response is received
        hideLoader();

      if (data.type.startsWith('image')) {
        const popupContent = document.getElementById('popupContent');

        // Container div for the image and button
        const imageContainer = document.getElementById('imageContainer');
         
        imageContainer.innerHTML = ''; // Clear any existing content

        const imageElement = document.createElement('img');
        const imageURL = URL.createObjectURL(data);
        imageElement.src = imageURL;
        imageElement.style.width = '300px';
        imageElement.style.height = '300px';
        imageContainer.appendChild(imageElement);
        imageElement.style.marginBottom = '20px';

        // Download button
        const downloadButton = document.createElement('button');
        downloadButton.innerText = 'Download QR';
        downloadButton.id = 'downloadButton'; // Set id attribute
        downloadButton.onclick = function () {
            downloadImage(imageURL);
        };

        // Append the download button after the image inside the container
        imageContainer.appendChild(downloadButton);

        openPopup();
    } else {
        document.getElementById('apiResponse').innerText = 'Image URL not found in the API response.';
        openPopup();
    }
    })
    .catch(error => {
        // Hide loader on error
        hideLoader();

        console.error('Error:', error);
        document.getElementById('apiResponse').innerText = 'Error occurred while processing the request.';
        openPopup();
    });
}

}

//highlight input fields
function highlightEmptyFields(value, fieldId){
    if (value === ''){
        document.getElementById(fieldId).classList.add('error');
    }
}
function highlightField(fieldId){
    document.getElementById(fieldId).classList.add('error');
}


//reset error highlight
function resetFieldHighlight(){
    var fields = ['firstname', 'jobtitle', 'company', 'phone', 'email', 'url'];
    fields.forEach(function (field){
        document.getElementById(field).classList.remove('error');
    });
}

//invalid inputs
function isValidPhone(phone){
    return /^\d+$/.test(phone);
}

function isValidEmail(email){
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Rest of the JavaScript code here

    function showLoader() {
        // Display loader and overlay
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('loader').style.display = 'block';
    }

    function hideLoader() {
        // Hide loader and overlay
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('loader').style.display = 'none';

        // Enable submit button when loader is hidden
        document.getElementById('submitBtn').disabled = false;
    }

    function downloadImage(imageURL) {
        // Create a link element
        const link = document.createElement('a');

        // Set the href attribute to the image source
        link.href = imageURL;

        // Set the download attribute with the desired filename
        link.download = 'downloaded_image.jpg';

        // Append the link to the document
        document.body.appendChild(link);

        // Trigger a click on the link to start the download
        link.click();

        // Remove the link from the document
        document.body.removeChild(link);
    }

    function openPopup() {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
    }

    function closePopup() {
        // Clear content inside the popupContent element
        const popupContent = document.getElementById('popupContent');
        while (popupContent.firstChild) {
            popupContent.removeChild(popupContent.firstChild);
        }
    
        // Hide overlay and popup
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('popup').style.display = 'none';
    }
</script>

</body>
</html>
